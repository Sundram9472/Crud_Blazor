@page "/"
@using Crud_Blazor.Components
@using Crud_Blazor.Data
@inject IJSRuntime _JsRuntime
@inject ServiceComponent Service

<div class="col-md-6">

    User ID:
    <input class="form-control" @bind="userName" />
    PassWord:
    <input class="form-control" @bind="PassWord" />
    <br />

    <button class="btn btn-info" @onclick="@(()=>CreateToken())">Login/Create Token</button>
    <button class="btn btn-info" @onclick="@(()=>PostMethod())">Post</button>

    <hr />
    <br />
    <label class="col-form-label">@Bearer</label>
    <label class="col-form-label">@Message</label>
</div>
@code{
    string userName;
    string PassWord;
    string Message;

    [Parameter]
    public string Bearer { get; set;  }

    public void CreateToken()
    {
        Message = "";
        Bearer = "";

        var response = Service.ResponseJson("http://localhost:36915/api/Login?userId=" + userName + "&pass=" + PassWord + "", null, null, null,RestSharp.Method.GET);

        if(response.StatusCode == System.Net.HttpStatusCode.OK)
        {
            var json = JsonConvert.DeserializeObject<Dictionary<string, string>>(response.Content)["token"].ToString();
            Bearer = json;
            Message = "Create Token Success:" + response.StatusCode.ToString();

        }
        else
        {
            Message = "Create Token Error:" + response.StatusCode.ToString();
        }
    }

    private void PostMethod()
    {
        Message = "";
        Dictionary<string, string> header = new Dictionary<string, string>();
        header.Add("Authorization", "Bearer " + Bearer);

        var value = Guid.NewGuid().ToString();

        var response = Service.ResponseJsonAuth("http://localhost:36915/api/Login", value, header, RestSharp.Method.GET);

        if(response.StatusCode == System.Net.HttpStatusCode.OK)
        {
            Message = "Post Success:" + response.StatusCode.ToString();
        }
        else
        {
            Message = "Post Error:" + response.StatusCode.ToString();
        }

    }

}